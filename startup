--[[ 
Author: Obnoxious_Ninja
File: openOS
Purpose: A component in my Operating system
Compatibility: Advanced computers
--]]

os.loadAPI("GUI_API")

os.pullEvent = os.pullEventRaw

function getSide()
  for _, side in ipairs(rs.getSides()) do
    if rednet.isOpen(side) then
      return side
	elseif peripheral.getType(side) == "modem" then
	  rednet.open(side)
	  return side
    end
  end
end

function checkRednet()
  for _, side in ipairs(rs.getSides()) do
    if rednet.isOpen(side) then
      return true
	elseif peripheral.getType(side) == "modem" then
	  rednet.open(side)
	  return true
	else
	  print("No modem detected.  Please add a wireless modem.")
    end
  end
end

function openRednet()
  for _, side in ipairs(rs.getSides()) do
    if peripheral.isPresent(side) and peripheral.getType(side) == "modem" then
      rednet.open(side)
      return side
    end
  end
end

local background = 32768
term.clear()

GUI_API.branding()
term.setCursorPos(1, 1)
print("LockTite Premium v1.3.2")
print("Property of AjinnDA")

write("Username: ")
local username = read()

write("Password: ")
local password = read("*")

local modemSide = openRednet()
  if modemSide == nil then
    print("No wireless modem connected")
	sleep(3)
	shell.run("startup")
  end

if checkRednet() then
  term.setBackgroundColor(background)
  if username == "test" and password == "test" then
    modem = peripheral.wrap(getSide())
	modem.transmit(1, 1, "Username: "..username.." Password: "..password)  
	
	    term.clear()
        term.setCursorPos(1, 1)
        term.setTextColor(32)
        print("Welcome back, "..username.."!\n")
        sleep(1)
        print("Logging in...")
        sleep(1)
		shell.run("OS.MAIN")
	
    else
      term.clear()
      term.setCursorPos(1, 1)
      term.setTextColor(colors.red)
      print("Incorrect username or password!")
      sleep(1)
      print("Go back? (y/n)")
      answer = read()
    
	if answer == "y" then
	  term.clear()
	  term.setCursorPos(1, 1)
	  term.setTextColor(1)
	  shell.run("startup")
		
	  else
		os.shutdown()
    end
  end
end
