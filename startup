--[[ 
Author: Obnoxious_Ninja
File: startup
Purpose: To provide a password lock for computers
Compatibility: Advanced computers
--]]

os.loadAPI("GUI_API")

os.pullEvent = os.pullEventRaw

function checkRednet()
  for _, side in ipairs(rs.getSides()) do
    if rednet.isOpen(side) then
      return true
	elseif peripheral.getType(side) == "modem" then
	  rednet.open(side)
	  return true
	else
	  print("No modem detected.  Please add a wireless modem.")
    end
  end
end

function openRednet()
  for _, side in ipairs(rs.getSides()) do
    if peripheral.isPresent(side) and peripheral.getType(side) == "modem" then
      rednet.open(side)
      return side
    end
  end
end

background = 32768
term.clear()

term.setCursorPos(1, 1)
print("LockTite Premium v1.3.2")
print("Property of AjinnDA")

write("Username: ")
username = read()

write("Password: ")
password = read("*")

modemSide = openRednet()
  if modemSide == nil then
    print("No wireless modem connected")
	sleep(5)
	shell.run("startup")
  end

if checkRednet() then
  term.setBackgroundColor(background)
  if username == "test" and password == "test" then
    modem = peripheral.wrap("back")
	modem.transmit(1, 1, "Username: "..username.." Password: "..password)  
    --peripheral.call("back", "transmit", 3, 1, "This will also work!")
	
	    term.clear()
        term.setCursorPos(1, 1)
        term.setTextColor(32)
        print("Welcome back, "..username.."!\n")
        sleep(1)
        print("Logging in...")
        sleep(1)
	    shell.run("OS.MAIN")
		--term.clear()
        --term.setCursorPos(1, 1)
	
    else
      term.clear()
      term.setCursorPos(1, 1)
      term.setTextColor(colors.red)
      print("Incorrect username or password!")
      sleep(1)
      print("Go back? (y/n)")
      answer = read()
    
	if answer == "y" then
	  term.clear()
	  term.setCursorPos(1, 1)
	  term.setTextColor(1)
	  shell.run("startup")
		
	  else
		os.shutdown()
    end
  end
  else
    print("blah blah blah")
end
